var NS2TRACE_URL="/ant/ant/ns2trace/";var MAX_NODES=100;var MAX_PORT=50;var INITIAL_POLL_INTERVAL=2000;var plot_options={series:{lines:{show:true,lineWidth:1},shadowSize:0},xaxis:{zoomrange:[0,100],panrange:[0,10]},yaxis:{zoomrange:[0,100],panrange:[0,10]},grid:{show:true,borderWidth:1,hoverable:true},crosshair:{mode:"x"},zoom:{interactive:false},pan:{interactive:false},legend:{show:true,container:$("#graphs-plotted"),labelFormatter:function(a,b){return('<span class="plot-legend-wrapper" title="Click to remove"><a href="/" class="plot-legend">'+a+"</a><span>")
}}};var alreadyFetchedPlotData={};var plot_data=[];var placeholder=$("#plotarea");function onDataReceived(e,f,i){if(e.data.length==0){alert("No data found for "+e.label);return}var d=0;var h=0;var a=0;
for(var g in plot_data){if(plot_data[g].label.indexOf(e.label)>=0){++d;if(plot_data[g].label.indexOf("(#")>0){++h;var c=parseInt(plot_data[g].label.split("(#")[1].split(")")[0])||-1;if(a<c){a=c}}}}var b=0;
if((h<d)||(a>0)){b=a+1}else{if(d&&(h==1)){b=1}}if(b>0){e.label+=" (#"+b+")"}plot_data.push(e);plot_options.xaxis.axisLabel=f;plot_options.yaxis.axisLabel=i;$.plot(placeholder,plot_data,plot_options)}function createSlidingDiv(b,e,a){$("div.slide-dialog").remove();
var c=$(document.createElement("div"));c.html(b);c.attr("class","slide-dialog");var d=$(document.createElement("div"));d.html("<strong>"+e+"</strong>");d.attr("class","close-dialog");$(d).click(function(){$(this).slideUp("slow");
$(this).parent().stop(true,true).slideUp("slow",function(){$(this).remove()})});c.prepend(d);c.css("display","none");if(a>0){c.insertAfter("div.toolbar").not(":animated").slideDown("slow").delay(a).slideUp("slow",function(){$(this).remove()
})}else{c.insertAfter("div.toolbar").slideDown("slow")}}function createSlidingDiv2(d,e,a){$("div.slide-dialog").remove();var b=$(document.createElement("div"));b.append(d);b.attr("class","slide-dialog");
var c=$(document.createElement("div"));c.html("<strong>"+e+"</strong>");c.attr("class","close-dialog");$(c).click(function(){$(this).slideUp("slow");$(this).parent().stop(true,true).slideUp("slow",function(){$(this).remove()
})});b.prepend(c);b.css("display","none");if(a>0){b.insertAfter("div.toolbar").not(":animated").slideDown("slow").delay(a).slideUp("slow",function(){$(this).remove()})}else{b.insertAfter("div.toolbar").slideDown("slow")
}}$(document).ready(function(){$("textarea.resizable:not(.processed)").TextAreaResizer();editAreaLoader.window_loaded();editAreaLoader.init({id:"ns2code",start_highlight:true,allow_resize:"both",allow_toggle:false,word_wrap:true,language:"en",syntax:"php",replace_tab_by_spaces:4});
$("div.ns2-form button#clear").click(function(a){$("div.ns2-code-output").empty();$("div.ns2-trace-text").text("")});$("div.ns2-form button#run").click(function(b){b.preventDefault();$("div.ns2-code-output").text("");
$("textarea.ns2-trace-text").text("");var a={ns2code:editAreaLoader.getValue("ns2code")};$("div.ns2-code-output").text(a);var c=$(document.createElement("img"));c.attr({src:"/cse28/ant/v_media/images/ajax/ajax_loader.gif",alt:"Loading ..."}).css({width:"auto",height:"auto",border:0,margin:0,"padding-left":"44.5%","padding-right":"44.5%","padding-top":"25px","padding-bottom":"25px"});
$("div.ns2-code-output").append(c);$(".trace-file-mode").removeAttr("checked");$.ajax({type:"POST",url:dutils.urls.resolve("ns2_submit"),data:a,cache:false,success:function(d,h,f){var e=d;var g="Simulation # <b>"+e.id+"</b> has been submitted. \n                <br>The result will appear here shortly.";
if(e.id){$(document.createElement("p")).html(g).css("text-align","center").attr("class","sim-start-mesg").appendTo("div.ns2-code-output");$.poll(INITIAL_POLL_INTERVAL,function(i){var j=dutils.urls.resolve("task_state",{uuid:e.id});
$.getJSON(j,function(n){var l=n.task;if(l.status.toUpperCase()=="SUCCESS"){$("p.sim-start-mesg").html("<b>Simulation completed ... Loading output</b>");var m=l.result;$("div.ns2-code-output").html(m.mesg.replace(/\n/g,"<br>"));
var o=0;for(var q in m.trace){var k=m.trace[q]+"";$("textarea.ns2-trace-text").append(k);o+=k.length}$("textarea.ns2-trace-text").css("height","250px");o=o/1024;var p=$("div.ns2-code-output").html();p+="<br>Loaded trace file of size "+o+" KB";
$("div.ns2-code-output").html(p);$(".trace-file-mode").removeAttr("disabled")}else{i()}})})}},error:function(d,f,e){$("div.ns2-code-output").html("Error: "+f+"; "+e+"; "+d.responseText)},dataType:"json"});
return false});$(".trace-file-mode").click(function(){var a=$(this).val();if(a=="Satellite"){alert("Please choose the 'Wired' mode to analyze trace files for exercises on satellite networks.");return}else{if(a=="Mixed"){alert("Mixed mode currently support only 'Average Throughput' calculation -- other results are NOT guaranteed!")
}}$(".trace-file-mode").attr("disabled","true");$(".toolbar").css({visibility:"visible"}).slideDown("slow");$.ajax({url:dutils.urls.resolve("trace_initialize",{sim_mode:a}),type:"GET",success:function(b,c,d){createSlidingDiv(b,"Mode Changed",5000);
$(".trace-file-mode").removeAttr("disabled");$(".toolbar").css({visibility:"visible"}).slideDown("slow")},error:function(c,b,d){createSlidingDiv(d,"Error",0);$(".trace-file-mode").removeAttr("disabled")
}})});$("#gen-stats").click(function(a){a.preventDefault();$.ajax({type:"GET",url:dutils.urls.resolve("trace_gen_stats"),success:function(b,d,c){createSlidingDiv(b,"Title",5000)},error:function(b,d,c){createSlidingDiv(""+c,"Error",0)
},dataType:"html"})});$("#avg-thruput-dialog").click(function(e){e.preventDefault();var a=$(document.createElement("div"));var c=$(document.createElement("label")).text("Please type in node # (starts from 0): ");
var b=$(document.createElement("input"));b.attr({type:"text",id:"avg-thruput-node",name:"avg-thruput-node"}).css("width","100px");$(a).append(c).append(b);var d=$(document.createElement("input"));d.attr({type:"button",id:"avg-thruput",value:"Show"}).click(function(){var f=parseInt($("#avg-thruput-node").val());
if(isNaN(f)||f<0){alert("Node # can only be a non-negative integer -- please revise your input!");$("#avg-thruput-node").focus();$("#avg-thruput-node").val("");return}else{if(f>MAX_NODES){alert("Sorry, currently we can support upto 100 nodes!");
$("#avg-thruput-node").val("");$("#avg-thruput-node").focus();return}}$(this).attr("disabled","true");$.ajax({type:"GET",url:dutils.urls.resolve("trace_avg_thruput",{node_id:f}),success:function(g,h,i){createSlidingDiv(g,"Average throughput of node #"+f+" (in Kbps)",5000)
},error:function(h,g,i){createSlidingDiv(""+i,"Error",0)},dataType:"html"})});$(a).append(d);createSlidingDiv2(a,"",0)});$("#e2e-delay-dialog").click(function(e){e.preventDefault();var a=$(document.createElement("div"));
var c=$(document.createElement("label")).text("Please type in source node # (starts from 0): ");var b=$(document.createElement("input"));b.attr({type:"text",id:"e2e-delay-src-node",name:"e2e-delay-src-node"}).css("width","100px");
$(a).append(c).append(b);var c=$(document.createElement("label")).text("Please type in destination node # (starts from 0): ");var b=$(document.createElement("input"));b.attr({type:"text",id:"e2e-delay-dst-node",name:"e2e-delay-dst-node"}).css("width","100px");
$(a).append($("<br>")).append(c).append(b);var c=$(document.createElement("label")).text("Please type in scaling factor [optional]: ");var b=$(document.createElement("input"));b.attr({type:"text",id:"delay-scale",name:"delay-scale",value:1}).css("width","100px");
$(a).append($(document.createElement("br"))).append(c).append(b);var d=$(document.createElement("input"));d.attr({type:"button",value:"Plot",id:"e2e-delay"}).click(function(){var g=parseInt($("#e2e-delay-src-node").val());
if(isNaN(g)||g<0){alert("Source node # can only be a non-negative integer -- please revise your input!");$("#e2e-delay-src-node").val("");$("#e2e-delay-src-node").focus();return}else{if(g>MAX_NODES){alert("Sorry, currently we can support upto 100 nodes!");
$("#e2e-delay-src-node").val("");$("#e2e-delay-src-node").focus();return}}var h=parseInt($("#e2e-delay-dst-node").val());if(isNaN(h)||h<0){alert("Destination node # can only be a non-negative integer -- please revise your input!");
$("#e2e-delay-dst-node").val("");$("#e2e-delay-dst-node").focus();return}else{if(h>MAX_NODES){alert("Sorry, currently we can support upto 100 nodes!");$("#e2e-delay-dst-node").val("");$("#e2e-delay-dst-node").focus();
return}}var f=parseInt($("#delay-scale").val());if(isNaN(f)||f==0){alert("Scale factor can only be a non-zero number -- please revise your input!");$("#delay-scale").val("");$("#delay-scale").focus();return
}$(this).attr("disabled","true");$.ajax({type:"GET",url:dutils.urls.resolve("trace_e2e_delay",{src_node:g,dst_node:h,scale:f}),success:function(i,j,k){createSlidingDiv(i,"End-to-end delay between nodes "+g+" and "+h,5000);
if(i.error){alert("Error:"+i.error)}else{onDataReceived(i,"Packet sequence #","End-to-end delay (in s)")}},error:function(j,i,k){createSlidingDiv(""+k+i,"Error",0)},dataType:"json"})});$(a).append(d);createSlidingDiv2(a,"",0)
});$("#pkt-retransmit-dialog").click(function(e){e.preventDefault();var a=$(document.createElement("div"));var c=$(document.createElement("label")).text("Please type in source node # (starts from 0): ");
var b=$(document.createElement("input"));b.attr({type:"text",id:"pkt-retransmit-src-node",name:"pkt-retransmit-src-node"}).css("width","100px");$(a).append(c).append(b);var c=$(document.createElement("label")).text("Please type in destination node # (starts from 0): ");
var b=$(document.createElement("input"));b.attr({type:"text",id:"pkt-retransmit-dst-node",name:"pkt-retransmit-dst-node"}).css("width","100px");$(a).append($("<br>")).append(c).append(b);var d=$(document.createElement("input"));
d.attr({id:"pkt-retransmit",value:"Plot",type:"button"});d.click(function(){var f=parseInt($("#pkt-retransmit-src-node").val());if(isNaN(f)||f<0){alert("Source node # can only be a non-negative integer -- please revise your input!");
$("#pkt-retransmit-src-node").val("");$("#pkt-retransmit-src-node").focus();return}else{if(f>MAX_NODES){alert("Sorry, currently we can support upto 100 nodes!");$("#pkt-retransmit-src-node").val("");$("#pkt-retransmit-src-node").focus();
return}}var g=parseInt($("#pkt-retransmit-dst-node").val());if(isNaN(g)||g<0){alert("Destination node # can only be a non-negative integer -- please revise your input!");$("#pkt-retransmit-dst-node").val("");
$("#pkt-retransmit-dst-node").focus();return}else{if(g>MAX_NODES){alert("Sorry, currently we can support upto 100 nodes!");$("#pkt-retransmit-dst-node").val("");$("#pkt-retransmit-dst-node").focus();return
}}$(this).attr("disabled","true");$.ajax({type:"GET",url:dutils.urls.resolve("trace_retransmits",{src_node:f,dst_node:g}),success:function(h,i,j){createSlidingDiv(h,"Packet retransmission count between nodes "+f+" and "+g,5000);
if(h.error){alert("Error:"+h.error)}else{onDataReceived(h,"Sequence #","# of transmissions")}},error:function(i,h,j){createSlidingDiv(""+j+h,"Error",0)},dataType:"json"})});$(a).append(d);createSlidingDiv2(a,"",0)
});$("#bytes-rcvd-dialog").click(function(f){f.preventDefault();var a=$(document.createElement("div"));var d=$(document.createElement("label")).text("Please type in node # (starts from 0): ");$(a).append(d);
var b=$(document.createElement("input"));b.attr({type:"text",id:"bytes-rcvd-node",name:"bytes-rcvd-node"}).css("width","100px");$(a).append(b);$(a).append($("<br>"));var g=$(document.createElement("span")).text("(For wireless scenario) At layer: ");
$(a).append(g);var c=$(document.createElement("input"));c.addClass("bytes-rcvd-layer");c.attr({type:"checkbox",name:"bytes-rcvd-layer",value:"MAC"});var g=$(document.createElement("span")).text("MAC").css("padding-right","4px");
$(a).append(c).append(g);var c=$(document.createElement("input"));c.addClass("bytes-rcvd-layer");c.attr({type:"checkbox",name:"bytes-rcvd-layer",value:"RTR"});var g=$(document.createElement("span")).text("RTR").css("padding-right","4px");
$(a).append(c).append(g);var c=$(document.createElement("input"));c.addClass("bytes-rcvd-layer");c.attr({type:"checkbox",name:"bytes-rcvd-layer",value:"AGT"});var g=$(document.createElement("span")).text("AGT").css("padding-right","4px");
$(a).append(c).append(g);var e=$(document.createElement("input"));e.attr({type:"button",id:"bytes-rcvd2",value:"Plot"});e.click(function(){var j=parseInt($("#bytes-rcvd-node").val());if(isNaN(j)||j<0){alert("Node # can only be a non-negative integer ("+j+") -- please revise your input!");
$("#bytes-rcvd-node").val("");$("#bytes-rcvd-node").focus();return false}else{if(j>MAX_NODES){alert("Sorry, currently we can support upto "+MAX_NODES+" nodes!");$("#bytes-rcvd-node").val("");$("#bytes-rcvd-node").focus();
return false}}$(this).attr("disabled","true");var i="";$(".bytes-rcvd-layer").each(function(){if($(this).is(":checked")){i+=$(this).val()+"|"}});var h=NS2TRACE_URL;h+="plot/bytes_rcvd/";h+=j;h+="/";if(i!=""){h+=i
}else{h+="X"}h+="/";$("div.slide-dialog").remove();var h=dutils.urls.resolve("trace_bytes_rcvd",{node_id:j,levels:i});h=h.replace("*)","");$.ajax({type:"GET",url:h,success:function(k,l,m){if(k.error){alert("Error: "+k.error)
}else{onDataReceived(k,"Time (in s)","Kbits received")}},error:function(l,k,m){createSlidingDiv(""+m,"Error",0)},dataType:"json"})});$(a).append(e);createSlidingDiv2(a,"",0)});$("#clear-session").click(function(a){a.preventDefault();
$.ajax({url:dutils.urls.resolve("trace_clr_session"),type:"GET",success:function(b,c,d){createSlidingDiv(b,"",5000)},error:function(c,b,d){createSlidingDiv(""+d,"Error",0)},dataType:"html"})});$("#hop-cnt-vs-seq-num-dialog").click(function(a){a.preventDefault();
var b=$(document.createElement("div"));var j=$(document.createElement("label")).text("Please type in source node # (starts from 0): ");var k=$(document.createElement("input"));var h=$(document.createElement("label")).text("Please type in source port # (starts from 0): ");
var i=$(document.createElement("input"));var g=$(document.createElement("label")).text("Please type in destination node # (starts from 0): ");var f=$(document.createElement("input"));var e=$(document.createElement("label")).text("Please type in destination port # (starts from 0): ");
var d=$(document.createElement("input"));k.attr({type:"text",id:"src-node",name:"src-node"}).css("width","100px");i.attr({type:"text",id:"src-port",name:"src-port",value:0}).css("width","100px");f.attr({type:"text",id:"dst-node",name:"dst-node"}).css("width","100px");
d.attr({type:"text",id:"dst-port",name:"dst-port",value:0}).css("width","100px");$(b).append(j).append(k);$(b).append($("<br>")).append(h).append(i);$(b).append($("<br>")).append(g).append(f);$(b).append($("<br>")).append(e).append(d).append($(document.createElement("div")).text("Please turn MAC trace on for wireless scenarios").css("border-top","1px dotted silver"));
var c=$(document.createElement("input"));c.attr({type:"button",id:"hop-count",value:"Plot"}).click(function(){var p=parseInt($("#src-node").val());if(isNaN(p)||n<0){alert("Node # can only be a non-negative integer -- please revise your input!");
$("#src-node").focus();$("#src-node").val("");return}else{if(p>MAX_NODES){alert("Sorry, currently we can support upto "+MAX_NODES+" nodes!");$("#src-node").val("");$("#src-node").focus();return}}var n=parseInt($("#src-port").val());
if(isNaN(n)||n<0){alert("Port # can only be a non-negative integer -- please revise your input!");$("#src_port").focus();$("#src_port").val("");return}var l=parseInt($("#dst-node").val());if(isNaN(l)||l<0){alert("Node # can only be a non-negative integer -- please revise your input!");
$("#dst-node").focus();$("#dst-node").val("");return}else{if(l>MAX_NODES){alert("Sorry, currently we can support upto 100 nodes!");$("#dst-node").val("");$("#dst-node").focus();return}}var o=parseInt($("#dst-port").val());
if(isNaN(o)||o<0){alert("Port # can only be a non-negative integer -- please revise your input!");$("#dst_port").focus();$("#dst_port").val("");return}$(this).attr("disabled","true");var m=NS2TRACE_URL+["plot/hop_cnt_seq_num",p,n,l,o].join("/")+"/";
$.ajax({type:"GET",url:dutils.urls.resolve("trace_hop_cnt",{src_node:p,src_port:n,dst_node:l,dst_port:o}),success:function(q,r,s){createSlidingDiv(q,"Hop count vs. packet sequence # plot",5000);if(q.error){alert("Error: "+q.error)
}else{onDataReceived(q,"Packet sequence #","Hop count")}},error:function(r,q,s){createSlidingDiv(""+s,"Error",0)},dataType:"json"})});$(b).append(c);createSlidingDiv2(b,"",0)});$("#filter-btn").click(function(f){var e=0;
var g=$.trim($("#filter-pattern").val());if(g.length==0){alert("Please type in a pattern to search!");$("#filter-pattern").focus();return}var a=[];var b="";var d=$(".ns2-code-output").html();if(d.search("<br>")>=0){a=d.split("<br>")
}else{a=d.split("<BR>")}for(var c in a){if(a[c].match(g)){++e;b=[b,a[c]].join("<br>")}}$("#pattern-match-count").text(e);$(".filtered-output").html(b)});$("#filter-clr").click(function(){$("#pattern-match-count").text(0);
$(".filtered-output").html("")});$("#custom-plot").click(function(g){g.preventDefault();if(!$("#custom-plot-data").val()){alert("Please type in some data to be plotted!");return}var j=($("#plot-label").val().length?$("#plot-label").val():"plot-label");
var f=($("#x-axis-label").val().length?$("#x-axis-label").val():"x-axis");var b=($("#y-axis-label").val().length?$("#y-axis-label").val():"y-axis");var k=$("#custom-plot-data").val().split("\n");var c=[];
for(var d=0;d<k.length;d++){var m=$.trim(k[d]);if(!m.length||m.indexOf(",")<0){continue}var l=m.split(",")[0];var h=m.split(",")[1];c.push([l,h])}var a={data:c,label:j};onDataReceived(a,f,b)});$("#reload-trace-file").click(function(a){a.preventDefault()
})});